<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>School Management System (Bootstrap)</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --sidebar-width: 260px
        }

        body {
            min-height: 100vh
        }

        .sidebar {
            width: var(--sidebar-width);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            padding: 1rem;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef
        }

        .content {
            margin-left: var(--sidebar-width);
            padding: 1.5rem
        }

        .nav-link.active {
            font-weight: 600
        }

        .table-actions button {
            margin-right: .25rem
        }

        @media (max-width: 767px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                border-right: none
            }

            .content {
                margin-left: 0
            }
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <div class="d-flex align-items-center mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor"
                class="bi bi-mortarboard-fill me-2" viewBox="0 0 16 16">
                <path
                    d="M8 0a1 1 0 0 0-.832.445L.166 6.333A1 1 0 0 0 0 7v1l8 4 8-4V7a1 1 0 0 0-.166-.667L8.832.445A1 1 0 0 0 8 0z" />
                <path d="M4.5 9.5v3.5a3 3 0 0 0 6 0V9.5" />
            </svg>
            <div>
                <h5 class="mb-0">SCHOOL SYS</h5>
                <small class="text-muted">Bootstrap prototype</small>
            </div>
        </div>
        <hr>
        <nav class="nav flex-column" id="mainNav">
            <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">Dashboard</a>
            <a class="nav-link" href="#students" data-bs-toggle="tab">Students</a>
            <a class="nav-link" href="#teachers" data-bs-toggle="tab">Teachers</a>
            <a class="nav-link" href="#classes" data-bs-toggle="tab">Classes</a>
            <a class="nav-link" href="#attendance" data-bs-toggle="tab">Attendance</a>
            <a class="nav-link" href="#exams" data-bs-toggle="tab">Exams</a>
            <a class="nav-link" href="#settings" data-bs-toggle="tab">Settings</a>
        </nav>
        <hr>
        <small class="text-muted">Local demo â€” data stored in browser localStorage</small>
    </div>

    <main class="content">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="mb-0">School Management System</h3>
            <div>
                <button class="btn btn-outline-primary" id="exportBtn">Export JSON</button>
                <button class="btn btn-outline-secondary" id="clearBtn">Clear Data</button>
            </div>
        </div>

        <div class="tab-content">
            <!-- Dashboard -->
            <section class="tab-pane fade show active" id="dashboard">
                <div class="row gy-3">
                    <div class="col-md-4">
                        <div class="card p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">Students</h6>
                                    <h3 id="countStudents">0</h3>
                                </div>
                                <div>
                                    <svg width="36" height="36" viewBox="0 0 16 16" class="bi bi-people-fill"
                                        fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M13 7c0-1.105-.672-2-1.5-2S10 5.895 10 7s.672 2 1.5 2S13 8.105 13 7zM6.5 6a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2 11s1-1 4-1 4 1 4 1v1H2v-1z" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">Teachers</h6>
                                    <h3 id="countTeachers">0</h3>
                                </div>
                                <div>
                                    <svg width="36" height="36" viewBox="0 0 16 16" class="bi bi-person-badge-fill"
                                        fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M6.5 2a2.5 2.5 0 1 1 5 0v1h-5V2zM3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3z" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">Classes</h6>
                                    <h3 id="countClasses">0</h3>
                                </div>
                                <div>
                                    <svg width="36" height="36" viewBox="0 0 16 16" class="bi bi-journal-text"
                                        fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5 8V7h6v1H5zm0 2v-1h6v1H5z" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="card p-3">
                            <h6>Recent students</h6>
                            <div class="table-responsive">
                                <table class="table table-sm" id="recentStudentsTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Name</th>
                                            <th>Class</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </section>

            <!-- Students -->
            <section class="tab-pane fade" id="students">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">Students</h4>
                    <div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#studentModal"
                            id="addStudentBtn">Add Student</button>
                    </div>
                </div>

                <div class="card p-3">
                    <div class="table-responsive">
                        <table class="table table-hover" id="studentsTable">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Name</th>
                                    <th>Gender</th>
                                    <th>Class</th>
                                    <th>Roll</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Teachers -->
            <section class="tab-pane fade" id="teachers">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">Teachers</h4>
                    <div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#teacherModal"
                            id="addTeacherBtn">Add Teacher</button>
                    </div>
                </div>
                <div class="card p-3">
                    <div class="table-responsive">
                        <table class="table table-hover" id="teachersTable">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Name</th>
                                    <th>Subject</th>
                                    <th>Phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Classes -->
            <section class="tab-pane fade" id="classes">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">Classes</h4>
                    <div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#classModal"
                            id="addClassBtn">Add Class</button>
                    </div>
                </div>
                <div class="card p-3">
                    <div class="table-responsive">
                        <table class="table table-hover" id="classesTable">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Class Name</th>
                                    <th>Teacher</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Attendance -->
            <section class="tab-pane fade" id="attendance">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">Attendance</h4>
                    <div>
                        <button class="btn btn-primary" id="markAttendanceBtn">Mark Attendance</button>
                    </div>
                </div>
                <div class="card p-3">
                    <small class="text-muted">This demo stores attendance as a simple record for the selected date and
                        class.</small>
                    <div class="mt-3">
                        <div class="row g-2 align-items-center">
                            <div class="col-md-4">
                                <select id="attendanceClass" class="form-select"></select>
                            </div>
                            <div class="col-md-3">
                                <input type="date" id="attendanceDate" class="form-control" value="">
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-success" id="loadAttendanceBtn">Load</button>
                            </div>
                        </div>

                        <div class="mt-3" id="attendanceArea"></div>

                    </div>
                </div>
            </section>

            <!-- Exams -->
            <section class="tab-pane fade" id="exams">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">Exams / Results</h4>
                    <div>
                        <button class="btn btn-primary" id="addResultBtn">Add Result (demo)</button>
                    </div>
                </div>
                <div class="card p-3">
                    <p class="mb-0 text-muted">This area can be expanded to provide grading, average calculations, and
                        report cards. For demo, we show a placeholder.</p>
                </div>
            </section>

            <!-- Settings -->
            <section class="tab-pane fade" id="settings">
                <div class="card p-3">
                    <h5>Settings</h5>
                    <p class="text-muted">Demo options.</p>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="demoDataSwitch">
                        <label class="form-check-label" for="demoDataSwitch">Load demo sample data on start</label>
                    </div>
                </div>
            </section>

        </div>

    </main>

    <!-- Modals -->
    <div class="modal fade" id="studentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form id="studentForm">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Student</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="studentId">
                        <div class="mb-3"><label class="form-label">Full name</label><input id="studentName" required
                                class="form-control"></div>
                        <div class="mb-3"><label class="form-label">Gender</label><select id="studentGender"
                                class="form-select">
                                <option>Male</option>
                                <option>Female</option>
                                <option>Other</option>
                            </select></div>
                        <div class="mb-3"><label class="form-label">Class</label><select id="studentClass"
                                class="form-select"></select></div>
                        <div class="mb-3"><label class="form-label">Roll / Admission #</label><input id="studentRoll"
                                class="form-control"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="teacherModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form id="teacherForm">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Teacher</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="teacherId">
                        <div class="mb-3"><label class="form-label">Full name</label><input id="teacherName" required
                                class="form-control"></div>
                        <div class="mb-3"><label class="form-label">Subject</label><input id="teacherSubject"
                                class="form-control"></div>
                        <div class="mb-3"><label class="form-label">Phone</label><input id="teacherPhone"
                                class="form-control"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="classModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form id="classForm">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Class</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="classId">
                        <div class="mb-3"><label class="form-label">Class name</label><input id="className" required
                                class="form-control" placeholder="e.g. Grade 8A"></div>
                        <div class="mb-3"><label class="form-label">Class teacher</label><select id="classTeacher"
                                class="form-select"></select></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // -------- Simple front-end "database" using localStorage --------
        const DB_KEY = 'sms_demo_db_v1';

        function makeId(prefix = 'id') {
            return prefix + '_' + Math.random().toString(36).slice(2, 9)
        }

        function getDB() {
            const data = localStorage.getItem(DB_KEY);
            if (!data) return { students: [], teachers: [], classes: [], attendance: [] }
            try { return JSON.parse(data) } catch (e) { return { students: [], teachers: [], classes: [], attendance: [] } }
        }
        function saveDB(db) { localStorage.setItem(DB_KEY, JSON.stringify(db)); renderAll(); }

        // Demo sample data
        const demo = (() => ({
            students: [{ id: makeId('s'), name: 'Aisha Kamau', gender: 'Female', classId: null, roll: 'S001' }, { id: makeId('s'), name: 'John Mwangi', gender: 'Male', classId: null, roll: 'S002' }],
            teachers: [{ id: makeId('t'), name: 'Mr. Otieno', subject: 'Mathematics', phone: '0700111222' }, { id: makeId('t'), name: 'Ms. Wanjiru', subject: 'English', phone: '0700222333' }],
            classes: [], attendance: []
        }))();

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            const settingsSwitch = document.getElementById('demoDataSwitch');
            if (!localStorage.getItem(DB_KEY)) {
                // default: no data
            }
            settingsSwitch.addEventListener('change', (e) => {
                if (e.target.checked) { localStorage.removeItem(DB_KEY); saveDB(Object.assign(getDB(), demo)); }
            })

            document.getElementById('studentForm').addEventListener('submit', onStudentSave);
            document.getElementById('teacherForm').addEventListener('submit', onTeacherSave);
            document.getElementById('classForm').addEventListener('submit', onClassSave);

            document.getElementById('exportBtn').addEventListener('click', onExport);
            document.getElementById('clearBtn').addEventListener('click', () => { if (confirm('Clear all data?')) { localStorage.removeItem(DB_KEY); renderAll(); } });

            document.getElementById('loadAttendanceBtn').addEventListener('click', loadAttendance);
            document.getElementById('markAttendanceBtn').addEventListener('click', () => { alert('Click Load, then mark attendance for students in that class.'); });

            // Preload demo data for convenience (if DB empty)
            if (!localStorage.getItem(DB_KEY)) {
                saveDB(Object.assign(getDB(), demo));
            } else {
                renderAll();
            }

            // activate tab links behaviour (keeps active class)
            document.querySelectorAll('#mainNav .nav-link').forEach(a => { a.addEventListener('shown.bs.tab', () => { document.querySelectorAll('#mainNav .nav-link').forEach(x => x.classList.remove('active')); a.classList.add('active'); }) });
        })

        // ---------- CRUD Handlers ----------
        function onStudentSave(e) {
            e.preventDefault();
            const id = document.getElementById('studentId').value;
            const name = document.getElementById('studentName').value.trim();
            const gender = document.getElementById('studentGender').value;
            const classId = document.getElementById('studentClass').value || null;
            const roll = document.getElementById('studentRoll').value.trim();
            const db = getDB();
            if (id) {
                const idx = db.students.findIndex(s => s.id === id);
                if (idx > -1) { db.students[idx] = { id, name, gender, classId, roll }; }
            } else {
                db.students.push({ id: makeId('s'), name, gender, classId, roll });
            }
            saveDB(db);
            bootstrap.Modal.getInstance(document.getElementById('studentModal')).hide();
            e.target.reset();
        }

        function onTeacherSave(e) {
            e.preventDefault();
            const id = document.getElementById('teacherId').value;
            const name = document.getElementById('teacherName').value.trim();
            const subject = document.getElementById('teacherSubject').value.trim();
            const phone = document.getElementById('teacherPhone').value.trim();
            const db = getDB();
            if (id) {
                const idx = db.teachers.findIndex(t => t.id === id);
                if (idx > -1) db.teachers[idx] = { id, name, subject, phone };
            } else {
                db.teachers.push({ id: makeId('t'), name, subject, phone });
            }
            saveDB(db);
            bootstrap.Modal.getInstance(document.getElementById('teacherModal')).hide();
            e.target.reset();
        }

        function onClassSave(e) {
            e.preventDefault();
            const id = document.getElementById('classId').value;
            const name = document.getElementById('className').value.trim();
            const teacherId = document.getElementById('classTeacher').value || null;
            const db = getDB();
            if (id) {
                const idx = db.classes.findIndex(c => c.id === id);
                if (idx > -1) db.classes[idx] = { id, name, teacherId };
            } else {
                db.classes.push({ id: makeId('c'), name, teacherId });
            }
            saveDB(db);
            bootstrap.Modal.getInstance(document.getElementById('classModal')).hide();
            e.target.reset();
        }

        // ---------- Render UI ----------
        function renderAll() {
            const db = getDB();
            // counts
            document.getElementById('countStudents').textContent = db.students.length;
            document.getElementById('countTeachers').textContent = db.teachers.length;
            document.getElementById('countClasses').textContent = db.classes.length;

            // Students table
            const stBody = document.querySelector('#studentsTable tbody'); stBody.innerHTML = '';
            db.students.forEach((s, i) => {
                const cls = db.classes.find(c => c.id === s.classId);
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${i + 1}</td><td>${escapeHtml(s.name)}</td><td>${escapeHtml(s.gender)}</td><td>${escapeHtml(cls ? cls.name : '-')}</td><td>${escapeHtml(s.roll)}</td><td class="table-actions"><button class="btn btn-sm btn-outline-secondary" onclick="editStudent('${s.id}')">Edit</button><button class="btn btn-sm btn-outline-danger" onclick="deleteStudent('${s.id}')">Delete</button></td>`;
                stBody.appendChild(tr);
            })

            // Teachers table
            const tBody = document.querySelector('#teachersTable tbody'); tBody.innerHTML = '';
            db.teachers.forEach((t, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${i + 1}</td><td>${escapeHtml(t.name)}</td><td>${escapeHtml(t.subject)}</td><td>${escapeHtml(t.phone)}</td><td class="table-actions"><button class="btn btn-sm btn-outline-secondary" onclick="editTeacher('${t.id}')">Edit</button><button class="btn btn-sm btn-outline-danger" onclick="deleteTeacher('${t.id}')">Delete</button></td>`;
                tBody.appendChild(tr);
            })

            // Classes table
            const cBody = document.querySelector('#classesTable tbody'); cBody.innerHTML = '';
            db.classes.forEach((c, i) => {
                const teacher = db.teachers.find(t => t.id === c.teacherId);
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${i + 1}</td><td>${escapeHtml(c.name)}</td><td>${escapeHtml(teacher ? teacher.name : '-')}</td><td class="table-actions"><button class="btn btn-sm btn-outline-secondary" onclick="editClass('${c.id}')">Edit</button><button class="btn btn-sm btn-outline-danger" onclick="deleteClass('${c.id}')">Delete</button></td>`;
                cBody.appendChild(tr);
            })

            // recent students
            const recent = document.querySelector('#recentStudentsTable tbody'); recent.innerHTML = '';
            db.students.slice(-5).reverse().forEach((s, i) => {
                const cls = db.classes.find(c => c.id === s.classId);
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${i + 1}</td><td>${escapeHtml(s.name)}</td><td>${escapeHtml(cls ? cls.name : '-')}</td><td><button class="btn btn-sm btn-outline-secondary" onclick="editStudent('${s.id}')">Edit</button></td>`;
                recent.appendChild(tr);
            })

            // populate selects
            const studentClassSelect = document.getElementById('studentClass');
            const attendanceClass = document.getElementById('attendanceClass');
            const classTeacherSelect = document.getElementById('classTeacher');
            [studentClassSelect, attendanceClass].forEach(sel => {
                sel.innerHTML = '<option value="">-- none --</option>' + db.classes.map(c => `<option value="${c.id}">${escapeHtml(c.name)}</option>`).join('');
            })
            classTeacherSelect.innerHTML = '<option value="">-- none --</option>' + db.teachers.map(t => `<option value="${t.id}">${escapeHtml(t.name)}</option>`).join('');
        }

        // ---------- Edit / Delete ----------
        function editStudent(id) { const db = getDB(); const s = db.students.find(x => x.id === id); if (!s) return; document.getElementById('studentId').value = s.id; document.getElementById('studentName').value = s.name; document.getElementById('studentGender').value = s.gender; document.getElementById('studentClass').value = s.classId || ''; document.getElementById('studentRoll').value = s.roll || ''; new bootstrap.Modal(document.getElementById('studentModal')).show(); }
        function deleteStudent(id) { if (!confirm('Delete student?')) return; const db = getDB(); db.students = db.students.filter(s => s.id !== id); saveDB(db); }

        function editTeacher(id) { const db = getDB(); const t = db.teachers.find(x => x.id === id); if (!t) return; document.getElementById('teacherId').value = t.id; document.getElementById('teacherName').value = t.name; document.getElementById('teacherSubject').value = t.subject; document.getElementById('teacherPhone').value = t.phone; new bootstrap.Modal(document.getElementById('teacherModal')).show(); }
        function deleteTeacher(id) {
            if (!confirm('Delete teacher?')) return; const db = getDB(); db.teachers = db.teachers.filter(t => t.id !== id); // also clear teacher from classes
            db.classes = db.classes.map(c => c.teacherId === id ? Object.assign({}, c, { teacherId: null }) : c); saveDB(db);
        }

        function editClass(id) { const db = getDB(); const c = db.classes.find(x => x.id === id); if (!c) return; document.getElementById('classId').value = c.id; document.getElementById('className').value = c.name; document.getElementById('classTeacher').value = c.teacherId || ''; new bootstrap.Modal(document.getElementById('classModal')).show(); }
        function deleteClass(id) { if (!confirm('Delete class? Students assigned to this class will not be deleted.')) return; const db = getDB(); db.classes = db.classes.filter(c => c.id !== id); db.students = db.students.map(s => s.classId === id ? Object.assign({}, s, { classId: null }) : s); saveDB(db); }

        // ---------- Attendance ----------
        function loadAttendance() {
            const classId = document.getElementById('attendanceClass').value;
            const date = document.getElementById('attendanceDate').value;
            if (!classId || !date) { alert('Select class and date first'); return; }
            const db = getDB();
            const students = db.students.filter(s => s.classId === classId);
            const attendanceRecord = db.attendance.find(a => a.classId === classId && a.date === date) || { classId, date, records: {} }
            const area = document.getElementById('attendanceArea');
            if (students.length === 0) { area.innerHTML = '<div class="alert alert-warning">No students in this class.</div>'; return; }
            const rows = students.map(s => {
                const present = !!attendanceRecord.records[s.id];
                return `<div class="d-flex align-items-center justify-content-between mb-2"><div>${escapeHtml(s.name)}</div><div><div class="form-check form-switch"><input class="form-check-input attendanceToggle" type="checkbox" data-student="${s.id}" ${present ? 'checked' : ''}></div></div></div>`
            }).join('');
            area.innerHTML = `<div>${rows}</div><div class="mt-3"><button id="saveAttendance" class="btn btn-success">Save Attendance</button></div>`;
            document.getElementById('saveAttendance').addEventListener('click', () => {
                const toggles = document.querySelectorAll('.attendanceToggle');
                const rec = { classId, date, records: {} };
                toggles.forEach(t => { if (t.checked) rec.records[t.dataset.student] = true });
                // replace or push
                const idx = db.attendance.findIndex(a => a.classId === classId && a.date === date);
                if (idx > -1) db.attendance[idx] = rec; else db.attendance.push(rec);
                saveDB(db); alert('Attendance saved');
            })
        }

        // ---------- Utilities ----------
        function onExport() { const db = getDB(); const blob = new Blob([JSON.stringify(db, null, 2)], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'school-data.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }

        function escapeHtml(s) { if (!s && s !== 0) return ''; return String(s).replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('"', '&quot;'); }

    </script>
</body>

</html>